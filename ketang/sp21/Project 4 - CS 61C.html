<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="language" content="english">
  <title>Project 4 - CS 61C</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="shortcut icon" type="image/png" href="https://inst.eecs.berkeley.edu/~cs61c/su21/img/favicon.png">
  <link rel="stylesheet" href="Project%204%20-%20CS%2061C_files/bootstrap.css" integrity="sha512-Ez0cGzNzHR1tYAv56860NLspgUGuQw16GiOOp/I2LuTmpSK9xDXlgJz3XN4cnpXWDmkNBKXR/VDMTCnAaEooxA==" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="Project%204%20-%20CS%2061C_files/main.css">

  



  <script defer="defer" src="Project%204%20-%20CS%2061C_files/tocbot.js" integrity="sha512-8u1QblAcGUuhEv26YgTYO3+OtPL7l37qiYoPQtahVTaiLn/H3Z/K16TOXJ3U7PDYBiJWCWKM0a+ELUDGDgED2Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>



  <script defer="defer" src="Project%204%20-%20CS%2061C_files/bootstrap.js" integrity="sha512-EKWWs1ZcA2ZY9lbLISPz8aGR2+L7JVYqBAYTq5AXgBkSjRSuQEGqWx8R1zAX16KdXPaCjOCaKE8MCpU0wcHlHA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script defer="defer" src="Project%204%20-%20CS%2061C_files/instantpage.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>
  <script defer="defer" type="text/javascript" src="Project%204%20-%20CS%2061C_files/main.js"></script>
</head>

<body>
  <main>
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
      <div class="container">
        <a class="navbar-brand" href="https://inst.eecs.berkeley.edu/~cs61c/su21/">
          <img class="d-inline-block me-2 rounded" src="Project%204%20-%20CS%2061C_files/icon-small.png" alt="logo" height="48">
          <span class="align-middle">CS 61C</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle Navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/su21/calendar/">Calendar</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/su21/staff/">Staff</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/su21/policies/">Policies</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://edstem.org/us/courses/6509/discussion/">Ed</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://oh.cs61c.org/">OH Queue</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://venus.cs61c.org/">Venus</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/su21/resources/">Resources</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/archives.html">Semesters</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <section class="section">
      <div class="container">
        

        
<div class="row spec">
  
    <div id="toc-wrapper" class="col-md-3 d-none d-md-block d-print-none sticky-top nav-wrapper"><ul class="toc-list nav flex-column"><li class="nav-item active"><a href="#overview" class="nav-link node-name--H2  active">Overview</a></li><li class="nav-item"><a href="#tips-and-guidelines" class="nav-link node-name--H2 ">Tips and Guidelines</a></li><li class="nav-item"><a href="#getting-started" class="nav-link node-name--H2 ">Getting Started</a></li><li class="nav-item"><a href="#task-1-matrix-functions-in-c" class="nav-link node-name--H2 ">Task 1: Matrix functions in C</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#throwing-errors" class="nav-link node-name--H3 ">Throwing Errors</a></li><li class="nav-item"><a href="#testing-for-correctness" class="nav-link node-name--H3 ">Testing for Correctness</a></li><li class="nav-item"><a href="#using-the-setup-file" class="nav-link node-name--H3 ">Using the setup file</a></li></ul></li><li class="nav-item"><a href="#task-2-writing-the-python-c-interface" class="nav-link node-name--H2 ">Task 2: Writing the Python-C interface</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#info-importing-numc-matrix" class="nav-link node-name--H3 ">Info: Importing numc.Matrix</a></li><li class="nav-item"><a href="#info-numc-matrix-initialization" class="nav-link node-name--H3 ">Info: numc.Matrix initialization</a></li><li class="nav-item"><a href="#info-numc-matrix-indexing" class="nav-link node-name--H3 ">Info: numc.Matrix indexing</a></li><li class="nav-item"><a href="#info-instance-attributes" class="nav-link node-name--H3 ">Info: instance attributes</a></li><li class="nav-item"><a href="#info-python-c-api-reference" class="nav-link node-name--H3 ">Info: Python/C API Reference</a></li><li class="nav-item"><a href="#quick-overview-of-numc-skeleton-code" class="nav-link node-name--H3 ">Quick Overview of numc skeleton code</a></li><li class="nav-item"><a href="#useful-functions" class="nav-link node-name--H3 ">Useful functions:</a></li><li class="nav-item"><a href="#number-methods" class="nav-link node-name--H3 ">Number Methods</a></li><li class="nav-item"><a href="#instance-methods" class="nav-link node-name--H3 ">Instance Methods</a></li><li class="nav-item"><a href="#indexing" class="nav-link node-name--H3 ">Indexing</a></li><li class="nav-item"><a href="#how-to-debug" class="nav-link node-name--H3 ">How to Debug</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#using-only-gdb" class="nav-link node-name--H4 ">Using only gdb</a></li><li class="nav-item"><a href="#using-both-gdb-and-pdb" class="nav-link node-name--H4 ">Using both gdb and pdb</a></li></ul></li></ul></li><li class="nav-item"><a href="#task-3-speeding-up-matrix-operations" class="nav-link node-name--H2 ">Task 3: Speeding up matrix operations</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#step-1-algorithmic-and-other-optimizations" class="nav-link node-name--H3 ">Step 1: Algorithmic and Other Optimizations</a></li><li class="nav-item"><a href="#step-2-simd-instructions" class="nav-link node-name--H3 ">Step 2: SIMD Instructions</a></li><li class="nav-item"><a href="#step-3-openmp" class="nav-link node-name--H3 ">Step 3: OpenMP</a></li><li class="nav-item"><a href="#loop-unrolling" class="nav-link node-name--H3 ">Loop Unrolling</a></li></ul></li><li class="nav-item"><a href="#task-4-tell-us-what-you-did" class="nav-link node-name--H2 ">Task 4: Tell us what you did!</a></li><li class="nav-item"><a href="#testing" class="nav-link node-name--H2 ">Testing</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#functions-in-tests-unittests-utils-py" class="nav-link node-name--H3 ">Functions in tests/unittests/utils.py</a></li><li class="nav-item"><a href="#more-about-unittest" class="nav-link node-name--H3 ">More about unittest</a></li></ul></li><li class="nav-item"><a href="#frequently-asked-questions" class="nav-link node-name--H2 ">Frequently Asked Questions</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#task-1" class="nav-link node-name--H3 ">Task 1</a></li><li class="nav-item"><a href="#task-2" class="nav-link node-name--H3 ">Task 2</a></li><li class="nav-item"><a href="#task-3" class="nav-link node-name--H3 ">Task 3</a></li><li class="nav-item"><a href="#autograder-related-questions" class="nav-link node-name--H3 ">Autograder-related Questions</a></li><li class="nav-item"><a href="#testing-questions" class="nav-link node-name--H3 ">Testing Questions</a></li></ul></li><li class="nav-item"><a href="#grading" class="nav-link node-name--H2 ">Grading</a></li><li class="nav-item"><a href="#submitting-your-code" class="nav-link node-name--H2 ">Submitting Your Code</a></li></ul></div>
  
  <div id="toc-content-wrapper" class="content col-md-9">
    <h1 class="title">Project 4: Numc</h1>
    
      <p class="subtitle">Deadline: Sunday, August 8, 11:59:59 PM PT</p>
    
    
    <style>
table {
    color: #333; /* Lighten up font color */
    font-family: Helvetica, Arial, sans-serif; /* Nicer font */
    border-collapse:
    collapse; border-spacing: 0;
    padding: 10px;
    align:center;
}

td, th { border: 1px solid #CCC; height: 30px; } /* Make cells a bit taller */

th {
    background: #F3F3F3; /* Light grey background */
    font-weight: bold; /* Make sure they're bold */
    padding: 10px;
}

td {
    background: #FAFAFA; /* Lighter grey background */
    text-align: center; /* Center our text */
    padding: 10px;
}

.grading-graphs td {
    width: 50%;
}

.container .row img {
  max-width: 100%;
}
</style>
<h2 id="overview">Overview</h2>
<p>This project is designed to be both a C project as well as a 
performance project. In this project you will be implementing a slower 
version of numpy, a very useful Python library for performing 
mathematical and logical operations on arrays and matrices. Your version
 of numpy, <code>numc</code> (how exciting!), is most likely to be 
slower than numpy, but much faster than the naive implementations of 
matrix operations. The steps of this project are as follows:</p>
<ol>
<li>You will first complete a naive solution for some matrix functions in C</li>
<li>You will gain a deeper understanding of the Python-C interface by 
overloading some operators and defining some instance methods for <code>numc.Matrix</code> objects</li>
<li>Finally, you will speed up your naive solution, thus making <code>numc.Matrix</code> operations faster.</li>
</ol>
<p>Do not expect your final completed <code>numc</code> module to be as 
good as numpy, but you should expect a very large speedup compared to 
the naive solution, especially for matrix multiplication and 
exponentiation!</p>
<h2 id="tips-and-guidelines">Tips and Guidelines</h2>
<div id="tip"></div>
<ul>
<li>Please start early! Because there are many more 61C students than 
Hive machines, you will likely share resources with your classmates. 
This might affect the measurement of your codeâ€™s speedup. We encourage 
you to use <a href="https://hivemind.eecs.berkeley.edu/">Hivemind</a> to help balance the load amongst the hive machines.
<ul>
<li>You will have 6 tokens every 6 hours for the Gradescope assignment.
So again, please start early!</li>
</ul>
</li>
<li>For this project, <strong>we strongly suggest working on Hive machines under your cs61c account</strong>.
 We have set up a few environment settings that only work if you use 
your cs61c account. If you run into issues related to not working on the
 Hive machines, we will <strong>NOT</strong> be able to help you.</li>
<li>If you would like to run the reference solution to compare your solution to, you can import the <strong><code>dumbpy</code></strong> library on hive as we have already installed it there for you!</li>
<li>We will not be directly testing your C code. All tests will be in Python!</li>
<li>You may change the skeleton code in <strong><code>src/numc.c</code></strong>, especially if you are not using a row-major setup for your matrices.</li>
<li>You may <strong>NOT</strong> add/remove any additional imports.</li>
<li>You may change the function signatures in the following files:
<ul>
<li><strong><code>src/matrix.h</code></strong> and <strong><code>src/matrix.c</code></strong> </li>
</ul>
</li>
<li>You may not change the function signatures in the following files:
<ul>
<li><strong><code>numc.h</code></strong> and <strong><code>src/numc.c</code></strong></li>
</ul>
</li>
<li>You will get negative points up to twice the number of points it is 
worth if you fail to complete task 4, so you should do it as much as you
 can even if you do not complete the entire project!</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<div class="alert alert-warning">
    <b>Warning</b>: this assignment allows groups of 2 students! If you 
have a group, one member should create the repo and invite the other 
group member to that repo. <b>The other group member should NOT create their own repo.</b> If you haven't decided on a group yet, don't create the repo yet. You will not be able to change groups after creating a repo!
</div>
<p>Visit <a href="https://galloc.cs61c.org/assignments/proj4">Galloc</a>.
 Log in and start the Project 4 assignment. A GitHub repo will be 
created for your team; this will be your repo for any Project 4 work you
 do. Then, clone your repository locally and add the starter remote:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> git clone YOUR_REPO_NAME
</span><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> cd YOUR_REPO_NAME
</span><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> git remote add starter https://github.com/61c-teach/su21-proj4-starter.git
</span><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> git pull starter main
</span></code></pre>
<p>If we publish changes to the starter code, retrieve them using <code>git pull starter main</code>.</p>
<p>To be able install the modules that you will complete in this project, you must create a virtual environment with by running</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> python3.6</span><span style="color:#bf616a;"> -m</span><span style="color:#c0c5ce;"> venv .venv
</span></code></pre>
<p>Note that you <strong>MUST</strong> use python 3.6 as our reference module <code>dumbpy</code>
 only supports this specific version of python.
Finally, run the following command to activate the virtual environment 
(a tool used to create isolated Python environments such that our 
project can have its own dependencies, regardless of what dependencies 
every other project has):</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> source .venv/bin/activate
</span></code></pre>
<p>This will put you in a virtual environment needed for this project. 
Please remember that if you exit the virtual environment and want to 
return to work on the project, you must re-run <code>source .venv/bin/activate</code>. This also means every time you re-ssh into the hive, you will have to re-run <code>source .venv/bin/activate</code>.</p>
<p>Then, run</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">pip3</span><span style="color:#c0c5ce;"> install</span><span style="color:#bf616a;"> -r</span><span style="color:#c0c5ce;"> requirements.txt
</span></code></pre>
<p>in the virtual environment. This will install all python packages you need for running your custom python tests.</p>
<p>Finally, if you have to exit out of the virtual environment, you can do so by running:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> deactivate
</span></code></pre>
<p><strong>We already have the reference library <code>dumbpy</code> installed for you on Hive machines.</strong>
 You can import it with or without the virtual environment while using 
python3.6, and all object and function names are the same as the <code>numc</code> module that you will use (please refer to <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#using-the-setup-file">using the setup file</a>). <strong>You will only be able to access the dumbpy package on hive as we will not be directly releasing it</strong>. You can use it as a reference for both correctness and speed.</p>
<p>Again, for this project, <strong>we strongly suggest working on Hive machines in your cs61c class account</strong>. <strong>You will not be able to import dumbpy if you are using other class accounts</strong>. We will be unable to help you with issues caused by working outside of the Hive.</p>
<h2 id="task-1-matrix-functions-in-c">Task 1: Matrix functions in C</h2>
<p><strong>Before contacting the staff about any issues that you encounter, please have a look through the FAQ <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#frequently-asked-questions">here</a>.</strong></p>
<p>For this task, you will need to complete all functions in <strong><code>src/matrix.c</code></strong> labelled with
<code>/* TODO: YOUR CODE HERE */</code>. The comments above each function signature in <strong><code>src/matrix.c</code></strong> contain instructions on how to implement the functions and the comments next to each variable of the <strong><code>matrix</code></strong> struct in <strong><code>src/matrix.h</code></strong> contain details about each variable, so read them carefully before you start coding.</p>
<p>The function <code>allocate_matrix_ref</code> is called from <strong><code>src/numc.c</code></strong>'s <code>Matrix61c_subscript</code> function and and is used for getting a row of the <code>from</code> matrix (see <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#indexing">Info: numc.Matrix indexing</a> for an example). Currently, <code>Matrix61c_subscript</code> and <code>allocate_matrix_ref</code>
 assume a row-major setup. If you choose to implement your matrices as 
column-major, you will have to change the implementation of <code>Matrix61c_subscript</code>, and you might also want to change the function signature of <code>allocate_matrix_ref</code>.</p>
<p>Again, you may change any function signature in <strong><code>src/matrix.h</code></strong> and <strong><code>src/matrix.c</code></strong>.</p>
<p><strong>Important notes</strong>:</p>
<ul>
<li>The <code>deallocate</code> function as well as the <code>ref_cnt</code> field in the <code>matrix</code> struct have caused a lot of confusions in the past semesters. It is important to remember that this <code>ref_cnt</code> is <strong>NOT</strong> Python's internal reference count. It is simply a field that will help you implement the <code>deallocate</code>
 function. It does not have to reflect the true reference count if you 
deem that setting it to other values will simplify your implementation 
of <code>deallocate</code>.</li>
<li>For the <code>deallocate</code> function, since there can be 
multiple matrices that refer to the same data array in the memory, you 
must not free the data until you call <code>deallocate</code> on the 
last existing matrix that refers to that data. If you are having some 
difficulties implementing this, here's a hint: you can keep the matrix 
struct in the memory even if you have already called <code>deallocate</code> on that matrix. <strong>You only need to make sure to that the struct is freed once the last matrix referring to its data is deallocated.</strong>
<ul>
<li>If this explanation does not make sense now, don't worry! It will make more sense after you implement the <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#indexing">indexing section</a> of task 2.</li>
</ul>
</li>
</ul>
<div id="throwing_errors"></div>
<h3 id="throwing-errors">Throwing Errors</h3>
<p><strong>For the following errors, please have a look at <code>PyExc_ValueError</code> and <code>PyExc_RuntimeError</code> in <code>PyErr_SetString</code> mentioned <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#useful-functions">here</a> to throw errors correctly. Make sure to test these errors and not to confuse the error types being thrown.</strong></p>
<table><thead><tr><th>Return value</th><th>Error (later thrown in Task 2)</th><th>When to return value</th></tr></thead><tbody>
<tr><td><code>-1</code></td><td><code>PyExc_ValueError </code></td><td>If you are trying to allocate matrices with non-positive dimensions.</td></tr>
<tr><td><code>-2</code></td><td><code>PyExc_RuntimeError </code></td><td>If <code>allocate_matrix</code> or <code>allocate_matrix_ref</code> fails to allocate space.</td></tr>
</tbody></table>
<p>Since you will use these return values to later throw these errors in <strong><code>src/numc.c</code></strong>, you would have to make sure that a runtime/value error will be thrown in <strong><code>src/numc.c</code></strong> whenever we run out of memory. <strong>This includes throwing an error in Matrix61c_init</strong>.</p>
<div id="mat=test"></div>
<h3 id="testing-for-correctness">Testing for Correctness</h3>
<p>We've provided some sanity in <code>tests/mat_test.c</code>. <strong>These tests make several assumptions:</strong></p>
<ul>
<li>They assume that all result matrices are already pre-allocated with 
the correct dimensions and that all input dimensions are valid.</li>
<li>They assume that you have not modified the <code>matrix</code> struct in <strong><code>src/matrix.h</code></strong></li>
<li>All tests except the tests for <code>get</code> and <code>set</code> assume that your <code>get</code> and <code>set</code> are correct</li>
<li>They assume that you have not modified the function signatures. <b> Note that you may still change the function signatures of <code>matrix.c</code> and <code>matrix.h</code> if you'd like to, as mentioned <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#tips-and-guidelines">here</a>.</b> These tests are different from the autograder tests because they only test <code>matrix.c</code> which is why you need to have the same function signatures here.</li>
</ul>
<p>Violation of one or more of these assumptions may not cause your 
tests to fail, but please keep this in mind if your tests are failing 
and you are violating at least one of these assumptions.</p>
<p>To run the CUnit tests, run</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> make test
</span></code></pre>
<p>in the root folder of your project. This will create an executable called <strong><code>test</code></strong> in the root folder and run it.</p>
<p>By default, CUnit will run these tests in Normal mode. When debugging
 a specific issue, it may be helpful to switch to Verbose mode, which 
can be done by commenting and uncommenting the relevant lines in <code>mat_test.c</code>:</p>
<pre style="background-color:#2b303b;"><code class="language-c" data-lang="c"><span style="color:#65737e;">// CU_basic_set_mode(CU_BRM_NORMAL);
</span><span style="color:#bf616a;">CU_basic_set_mode</span><span style="color:#c0c5ce;">(CU_BRM_VERBOSE);
</span></code></pre>
<p>Make sure that one line is uncommented at a time.</p>
<p>Please keep in mind that these tests are not comprehensive, and 
passing all the sanity tests does not necessarily mean your 
implementation is correct. This is especially true with the memory 
functions <code>allocate_matrix</code>, <code>allocate_matrix_ref</code>, and <code>deallocate_matrix</code>. Also keep in mind that the autograder will be using our own set of sanity tests, and will not be running your CUnit tests.</p>
<p>Another thing to note is that the <strong><code>Makefile</code></strong> is written for compilation on the hive machines. If you wish to run it locally, you will have to modify the <strong><code>Makefile</code></strong> by replacing the path to your CUnit/Python libraries in your <code>CUNIT</code> and <code>PYTHON</code> variables. You will also need to make sure that your local computer supports AVX extensions and OpenMP.</p>
<p>Finally, you are welcomed to modify the <strong><code>tests/mat_test.c</code></strong> file in the <code>tests</code>
 directory to implement your custom test cases. To add your own custom 
tests, you will need to define your own test function and possibly use 
any of the <code>CU_ASSERT_EQUAL</code>, <code>CU_ASSERT_NOT_EQUAL</code>, or <code>CU_ASSERT_PTR_EQUAL</code> CUnit test cases to compare any value that you would like (Suggestion: there are more possible CUnit Test Cases linked <a href="http://cunit.sourceforge.net/doc/writing_tests.html">here</a>. Lastly, you will need to call <code>CU_add_test</code>
 to the main function to run your newly created function! A good place 
to start is to look at some of the provided tests and use the general 
approach to your own specific tests.</p>
<h3 id="using-the-setup-file">Using the setup file</h3>
<p>The <code>setup.py</code> file is used for installing your 
custom-built modules and has been already provided to you. Have a look 
at the code and make sure to understand what is being done. You should 
be able to install <code>numc</code> by simply running:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> make
</span></code></pre>
<p>This will uninstall your previously installed <code>numc</code> module if it existed and reinstall <code>numc</code>. We have written <code>src/numc.c</code> so that <code>numc.Matrix</code> will be initialized and ready to import upon succesful installation of the <code>numc</code> module. You should rerun <code>make</code> every time you make changes and want them to be reflected in the <code>numc</code> module.</p>
<p>You can uninstall your <code>numc</code> module by running</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> make uninstall
</span></code></pre>
<p>You will likely get a lot of warnings about functions being defined 
but not used, and that's ok! You should ignore these warnings for now, 
and they will be gone after you finish writing Task 2.</p>
<p>Remember that <strong>you must be in the virtual environment that you set up in order to install the modules</strong>, otherwise you will get a "Read-only file system" error.</p>
<div id="task-2-interface"></div>
<h2 id="task-2-writing-the-python-c-interface">Task 2: Writing the Python-C interface</h2>
<p><strong>Before contacting the staff about any issues that you encounter, please have a look through the FAQ <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#frequently-asked-questions">here</a>.</strong></p>
<p>Now that you have successfully installed your <code>numc</code> module, you can import your <code>numc.Matrix</code> objects in Python programs! Here are some ready-to-use features already implemented for <code>numc.Matrix</code> objects. You might find them helpful when debugging Task 2.</p>
<h3 id="info-importing-numc-matrix">Info: Importing <code>numc.Matrix</code></h3>
<p>Here are several ways of importing <code>numc.Matrix</code></p>
<pre style="background-color:#2b303b;"><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span style="color:#c0c5ce;">numc </span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">Matrix

</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">numc
numc.Matrix

</span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">numc </span><span style="color:#b48ead;">as </span><span style="color:#c0c5ce;">nc
nc.Matrix
</span></code></pre><h3 id="info-numc-matrix-initialization">Info: <code>numc.Matrix</code> initialization</h3>
<p>The code block below lists all the different ways of creating a <code>numc.Matrix</code> object.</p>
<pre style="background-color:#2b303b;"><code class="language-python" data-lang="python"><span style="color:#c0c5ce;">&gt;&gt;&gt; </span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">numc </span><span style="color:#b48ead;">as </span><span style="color:#c0c5ce;">nc
</span><span style="color:#bf616a;">CS61C </span><span style="color:#c0c5ce;">Summer </span><span style="color:#d08770;">2021 </span><span style="color:#c0c5ce;">Project </span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">: numc imported!
&gt;&gt;&gt; nc.</span><span style="color:#bf616a;">Matrix</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">) </span><span style="color:#65737e;"># This creates a 3 * 3 matrix with entries all zeros
</span><span style="color:#c0c5ce;">[[</span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">]]
&gt;&gt;&gt; nc.</span><span style="color:#bf616a;">Matrix</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">) </span><span style="color:#65737e;"># This creates a 3 * 3 matrix with entries all ones
</span><span style="color:#c0c5ce;">[[</span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">]]
&gt;&gt;&gt; nc.</span><span style="color:#bf616a;">Matrix</span><span style="color:#c0c5ce;">([[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">6</span><span style="color:#c0c5ce;">]]) </span><span style="color:#65737e;"># This creates a 2 * 3 matrix with first row 1, 2, 3, second row 4, 5, 6
</span><span style="color:#c0c5ce;">[[</span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">4.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">5.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">6.0</span><span style="color:#c0c5ce;">]]
&gt;&gt;&gt; nc.</span><span style="color:#bf616a;">Matrix</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, [</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">]) </span><span style="color:#65737e;"># This creates a 1 * 2 matrix with entries 4, 5
</span><span style="color:#c0c5ce;">[[</span><span style="color:#d08770;">4.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">5.0</span><span style="color:#c0c5ce;">]]
</span></code></pre>
<p>More specifically:</p>
<ul>
<li><code>nc.Matrix(rows: int, cols: int)</code> will create a matrix with <code>rows</code> rows and <code>cols</code> cols. All entries in this matrix are defaulted to 0.</li>
<li><code>nc.Matrix(rows: int, cols: int, val: int/float)</code> will create a matrix with <code>rows</code> rows and <code>cols</code> cols. All entries in this matrix will be initialized to <code>val</code>.</li>
<li><code>nc.Matrix(rows: int, cols: int, lst: List[int/float])</code> will create a matrix with <code>rows</code> rows and <code>cols</code> cols. <code>lst</code> must have length <code>rows * cols</code>, and entries of the matrix will be initialized to values of <code>lst</code> in a row-major order.</li>
<li><code>nc.Matrix(lst: List[List[int/float]])</code> will create a matrix with the same shape as the 2D <code>lst</code> (i.e. each list in <code>lst</code> is a row for this matrix).</li>
</ul>
<div id="indexing"></div>
<h3 id="info-numc-matrix-indexing">Info: <code>numc.Matrix</code> indexing</h3>
<p>You can index into a matrix and change either the value of one single entry or an entire row. More specifically, <code>mat[i]</code> should give you the <code>i</code>th row of <code>mat</code>. If <code>mat</code> has more than 1 column, <code>mat[i]</code> should also be of type <code>numc.Matrix</code> with (<code>mat</code>'s number of columns, 1) as its shape. In other words, <code>mat[i]</code> returns a column vector. This is to support 2D indexing of <code>numc</code> matrices.</p>
<p>If <code>mat</code> only has one column, then <code>mat[i]</code> will return a double. <code>mat[i][j]</code> should give you the entry at the <code>i</code>th row and <code>j</code>th column. If you are setting one single entry by indexing, the data type must be <code>float</code> or <code>int</code>.
 If you are setting an entire row of a matrix that has more than one 
column, you must provide a 1D list that has the same length as the 
number of columns of that matrix. Every element of this list must be 
either of type <code>float</code> or <code>int</code>.</p>
<p>Please note that if <code>mat[i]</code> has more than 1 entry, it will share data with <code>mat</code>, and changing <code>mat[i]</code> will result in a change in <code>mat</code>.</p>
<p>The example given below assumes the matrices are initialized from the code block above.</p>
<pre style="background-color:#2b303b;"><code class="language-python" data-lang="python"><span style="color:#c0c5ce;">&gt;&gt;&gt; </span><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">numc </span><span style="color:#b48ead;">as </span><span style="color:#c0c5ce;">nc
</span><span style="color:#bf616a;">CS61C </span><span style="color:#c0c5ce;">Summer </span><span style="color:#d08770;">2021 </span><span style="color:#c0c5ce;">Project </span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">: numc imported!
&gt;&gt;&gt; mat = nc.</span><span style="color:#bf616a;">Matrix</span><span style="color:#c0c5ce;">([[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">6</span><span style="color:#c0c5ce;">]]) </span><span style="color:#65737e;"># This creates a 2 * 3 matrix with first row 1, 2, 3, second row 4, 5, 6
</span><span style="color:#c0c5ce;">&gt;&gt;&gt; mat
[[</span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">4.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">5.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">6.0</span><span style="color:#c0c5ce;">]]
&gt;&gt;&gt; slice = mat[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">]
&gt;&gt;&gt; slice
[[</span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">2.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">3.0</span><span style="color:#c0c5ce;">]] 
&gt;&gt;&gt; slice[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">]
</span><span style="color:#d08770;">1.0
</span><span style="color:#c0c5ce;">&gt;&gt;&gt; slice[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">] = </span><span style="color:#d08770;">10.0 </span><span style="color:#65737e;"># Change a value in slice
</span><span style="color:#c0c5ce;">&gt;&gt;&gt; slice
[[</span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">10.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">3.0</span><span style="color:#c0c5ce;">]]
&gt;&gt;&gt; mat </span><span style="color:#65737e;"># Mat is changed as well
</span><span style="color:#c0c5ce;">[[</span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">10.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">4.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">5.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">6.0</span><span style="color:#c0c5ce;">]]
</span></code></pre>
<p>Partial slices, however, are not supported. For example,</p>
<pre style="background-color:#2b303b;"><code class="language-python" data-lang="python"><span style="color:#c0c5ce;">mat[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">:</span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">] </span><span style="color:#65737e;"># not allowed
</span><span style="color:#c0c5ce;">mat[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">][</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">:</span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">] </span><span style="color:#65737e;"># not allowed
</span></code></pre><h3 id="info-instance-attributes">Info: instance attributes</h3>
<p>The matrices and vectors have an attribute shape, which is a tuple of <code>(rows, cols)</code>. Example is given below.</p>
<pre style="background-color:#2b303b;"><code class="language-python" data-lang="python"><span style="color:#c0c5ce;">&gt;&gt;&gt; mat.</span><span style="color:#bf616a;">shape
</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">)
</span></code></pre><h3 id="info-python-c-api-reference">Info: Python/C API Reference</h3>
<p>Here is the link to the full reference manual: <a href="https://docs.python.org/3.6/c-api/index.html">https://docs.python.org/3.6/c-api/index.html</a>. If you ever find anything confusing in the skeleton code or are at a lost on how to implement <strong><code>src/numc.c</code></strong>, this is a great resource.</p>
<hr>
<h3 id="quick-overview-of-numc-skeleton-code">Quick Overview of <code>numc</code> skeleton code</h3>
<p>We define the <code>Matrix61c</code> struct in <strong><code>numc.h</code></strong>. It is of type <code>PyObject</code> (this means you can always cast <code>Matrix61c</code> to <code>PyObject</code>,
 but not vice versa), which according to the official documentation, 
"contains the information Python needs to treat a pointer to an object 
as an object". Our <code>Matrix61c</code> has the <code>matrix</code> struct we defined in <strong><code>src/matrix.h</code></strong>.</p>
<p>Then we define a struct <code>PyTypeObject</code> named <code>Matrix61cType</code> to specify the intended behaviors of our Python object <code>Matrix61c</code>. This struct will then be initialized to be our <code>numc.Matrix</code> objects.</p>
<pre style="background-color:#2b303b;"><code class="language-c" data-lang="c"><span style="color:#b48ead;">static</span><span style="color:#c0c5ce;"> PyTypeObject Matrix61cType = {
    </span><span style="color:#bf616a;">PyVarObject_HEAD_INIT</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">NULL</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
    .</span><span style="color:#bf616a;">tp_name </span><span style="color:#c0c5ce;">= "</span><span style="color:#a3be8c;">numc.Matrix</span><span style="color:#c0c5ce;">",
    .</span><span style="color:#bf616a;">tp_basicsize </span><span style="color:#c0c5ce;">= sizeof(Matrix61c),
    .</span><span style="color:#bf616a;">tp_dealloc </span><span style="color:#c0c5ce;">= (destructor)Matrix61c_dealloc,
    .</span><span style="color:#bf616a;">tp_repr </span><span style="color:#c0c5ce;">= (reprfunc)Matrix61c_repr,
    .</span><span style="color:#bf616a;">tp_as_number </span><span style="color:#c0c5ce;">= &amp;Matrix61c_as_number,
    .</span><span style="color:#bf616a;">tp_flags </span><span style="color:#c0c5ce;">= Py_TPFLAGS_DEFAULT |
        Py_TPFLAGS_BASETYPE,
    .</span><span style="color:#bf616a;">tp_doc </span><span style="color:#c0c5ce;">= "</span><span style="color:#a3be8c;">numc.Matrix objects</span><span style="color:#c0c5ce;">",
    .</span><span style="color:#bf616a;">tp_methods </span><span style="color:#c0c5ce;">= Matrix61c_methods,
    .</span><span style="color:#bf616a;">tp_members </span><span style="color:#c0c5ce;">= Matrix61c_members,
    .</span><span style="color:#bf616a;">tp_as_mapping </span><span style="color:#c0c5ce;">= &amp;Matrix61c_mapping,
    .</span><span style="color:#bf616a;">tp_init </span><span style="color:#c0c5ce;">= (initproc)Matrix61c_init,
    .</span><span style="color:#bf616a;">tp_new </span><span style="color:#c0c5ce;">= Matrix61c_new
};
</span></code></pre>
<p>For example, <code>.tp_dealloc</code> tells Python which function to call to destroy a <code>numc.Matrix</code> object when its reference count becomes 0, and <code>.tp_members</code> tells Python what instance attributes <code>numc.Matrix</code> objects have. You can take a look at the <a href="https://docs.python.org/3.6/c-api/typeobj.html">official documentation</a> if you are curious.</p>
<h3 id="useful-functions">Useful functions:</h3>
<p>Here is a list of some functions and Python objects from <code>&lt;Python.h&gt;</code> that you may find useful. You can also choose any other functions at this <a href="https://docs.python.org/3.6/c-api/index.html">link</a>.</p>
<ul>
<li><a href="https://docs.python.org/3.6/c-api/object.html">PyObject_TypeCheck</a></li>
<li><a href="https://docs.python.org/3.6/c-api/exceptions.html">PyErr_SetString</a></li>
<li><a href="https://docs.python.org/3.6/c-api/arg.html">Py_BuildValue</a></li>
<li><a href="https://docs.python.org/3.6/c-api/tuple.html">PyTupleObject</a></li>
<li><a href="https://docs.python.org/3.6/c-api/long.html">PyLongObject</a></li>
<li><a href="https://docs.python.org/3.6/c-api/float.html">PyFloatObject</a></li>
<li><a href="https://docs.python.org/3.6/c-api/list.html">PyListObject</a></li>
</ul>
<hr>
<p>Now you are ready to complete <strong><code>src/numc.c</code></strong>, the Python-C interface! As before, you will need to fill out all functions and variables labeled <code>/* TODO: YOUR CODE HERE */</code>. The code for initializing the module <code>numc</code> and the object type <code>numc.Matrix</code>
 is already done for you. Although not required, we encourage you to 
take a look at the existing code to better understand the interface.</p>
<p>Below are the two main parts for this task.</p>
<p><b> Note: Don't forget to use the return values from task 1 to throw <code>PyExc_ValueError</code> and <code>PyExc_RuntimeError</code> in <code>src/numc.c</code>! Here is the error table for your convenience:</b></p>
<table><thead><tr><th>Return value</th><th>Error</th><th>When to return value</th></tr></thead><tbody>
<tr><td><code>-1</code></td><td><code>PyExc_ValueError </code></td><td>If you are trying to allocate matrices with non-positive dimensions.</td></tr>
<tr><td><code>-2</code></td><td><code>PyExc_RuntimeError </code></td><td>If <code>allocate_matrix</code> or <code>allocate_matrix_ref</code> fails to allocate space.</td></tr>
</tbody></table>
<h3 id="number-methods">Number Methods</h3>
<p>For this part, we ask you to overload operators for <code>numc.Matrix</code> objects. <strong>For the following operations and functions, please have a look at <code>PyExc_TypeError</code>, <code>PyExc_ValueError</code>, and <code>PyExc_IndexError</code> in <code>PyErr_SetString</code> to throw errors correctly. Make sure to test these errors and not to confuse the error types being thrown.</strong>
 We have made subtraction and negation optional to reduce the amount of 
redundant work for the project. Feel free to implement these functions 
if you would like. We have provided autograder tests for you to test 
their functionality. Extra points will NOT be awarded for implementing 
the optional functions. Here are the expected behaviors of overloaded 
operators:</p>
<table><thead><tr><th>Operator</th><th align="left">Function</th><th align="left">Description</th><th align="left">Throwing Errors</th></tr></thead><tbody>
<tr><td>+</td><td align="left"><code>Matrix61c_add</code></td><td align="left">Element-wise sum of <code>a</code> and <code>b</code>. Returns a <code>numc.Matrix</code> object.</td><td align="left"><ul><li><code>TypeError</code> if either <code>a</code> or <code>b</code> is not of type <code>numc.Matrix</code>.</li><li><code>ValueError</code> if <code>a</code> and <code>b</code> do not have the same dimensions.</li></ul></td></tr>
<tr><td>- (subtraction)</td><td align="left"><code>Matrix61c_sub</code></td><td align="left"><strong>(Optional)</strong> Element-wise subtraction of <code>a</code> and <code>b</code>. Returns a <code>numc.Matrix</code> object. It is optional and will not be graded since its implementation is very similar to <code>Matrix61c_add</code>.</td><td align="left"><ul><li><code>TypeError</code> if either <code>a</code> or <code>b</code> is not of type <code>numc.Matrix</code>.</li><li><code>ValueError</code> if <code>a</code> and <code>b</code> do not have the same dimensions.</li></ul></td></tr>
<tr><td>*</td><td align="left"><code>Matrix61c_multiply</code></td><td align="left">Matrix multiplication of <code>a</code> and <code>b</code>. Returns a <code>numc.Matrix</code> object. Remember that this is a matrix multiplication, not an element-wise multiplication.</td><td align="left"><ul><li><code>TypeError</code> if either <code>a</code> or <code>b</code> is not of type <code>numc.Matrix</code>.</li><li><code>ValueError</code> if <code>a</code>'s number of columns is not equal to <code>b</code>'s number of rows.</li></ul></td></tr>
<tr><td>- (negation)</td><td align="left"><code>Matrix61c_neg</code></td><td align="left"><strong>(Optional)</strong> Element-wise negation of <code>a</code>. Returns a <code>numc.Matrix</code> object. It is optional since the implementation is simple when using other helper operators within the current list.</td><td align="left"><code>TypeError</code> if <code>a</code> is not of type <code>numc.Matrix</code>.</td></tr>
<tr><td>abs()</td><td align="left"><code>Matrix61c_abs</code></td><td align="left">Element-wise absolute value of <code>a</code>. Returns a <code>numc.Matrix</code> object.</td><td align="left"><code>TypeError</code> if <code>a</code> is not of type <code>numc.Matrix</code>.</td></tr>
<tr><td>**</td><td align="left"><code>Matrix61c_pow</code></td><td align="left">Raise <code>a</code> to the <code>pow</code>th power. <code>a</code> to the 0th power is the identity matrix (1 on the top left to bottom right diagonal and 0 everywhere else). Returns a <code>numc.Matrix</code> object. This operator is defined in terms of matrix multiplication, not element-wise multiplication.</td><td align="left"><ul><li><code>TypeError</code> if <code>a</code> is not of type <code>numc.Matrix</code> or <code>pow</code> is not an integer.</li><li><code>ValueError</code> if <code>a</code> is not a square matrix or if <code>pow</code> is negative.</li></ul></td></tr>
</tbody></table>
<p><strong>Please note that for all these operations above, you never directly modify the matrix that you pass in.</strong> You always make a new <code>numc.Matrix</code> object to hold your result, so <strong>make sure you set the <code>shape</code> attribute of the new <code>numc.Matrix</code>.</strong> You can use <code>Matrix61c_new</code> to create new <code>numc.Matrix</code> objects. Take a look at the implementation of <code>Matrix61c_subscript</code> for an example.</p>
<p>For all the functions above, throw a runtime error using <code>PyExc_RuntimeError</code> (similarly to <code>PyExc_ValueError</code>, <code>PyExc_TypeError</code>, and <code>PyExc_IndexError</code>
 as mentioned above) if any error occurs (such as matrix allocation 
failure) and causes the operation to fail. Moreover, for any operations 
that involve two instances of <code>numc.Matrix</code>, you will have to make sure that both <code>a</code> and <code>b</code> are indeed of type <code>numc.Matrix</code> as we do not support operations between <code>numc.Matrix</code> and other data/object types. <strong>Please read the comments in <code>src/numc.c</code> carefully</strong>.</p>
<p>After you implement all the functions above, you will need to fill out the struct <code>Matrix61c_as_number</code> in <code>src/numc.c</code>, which is used to define the object type <code>numc.Matrix</code>. <strong>Remember to cast your functions to the correct types when assigning them to <code>Matrix61c_as_number</code>'s fields!</strong> Here is the link to the official documentation of a <code>PyNumberMethods</code> struct: <a href="https://docs.python.org/3/c-api/typeobj.html#c.PyNumberMethods">https://docs.python.org/3/c-api/typeobj.html#c.PyNumberMethods</a></p>
<h3 id="instance-methods">Instance Methods</h3>
<p>You will implement two instance methods for <code>numc.Matrix</code>:</p>
<table><thead><tr><th>Method</th><th>C Function</th><th align="left">Description</th><th align="left">Throwing Errors</th></tr></thead><tbody>
<tr><td><code>set</code></td><td><code>Matrix61c_set_value</code></td><td align="left">Set <code>self</code>'s entry at the <code>i</code>th row and <code>j</code>th column to <code>val</code>.</td><td align="left"><ul><li><code>TypeError</code> if the number of arguments parsed from args is not 3, if <code>i</code> and <code>j</code> are not integers, or if <code>val</code> is not a <code>float</code> or <code>int</code>.</li><li><code>IndexError</code> if <code>i</code> or <code>j</code> or both are out of range.</li></ul></td></tr>
<tr><td><code>get</code></td><td><code>Matrix61c_get_value</code></td><td align="left">Returns the entry at the <code>i</code>th row and <code>j</code>th column. Return value is a Python <code>float</code>.</td><td align="left"><ul><li><code>TypeError</code> if the number of arguments parsed from args is not 2 or if either <code>i</code> or <code>j</code> is not an integer.</li><li><code>IndexError</code> if <code>i</code> or <code>j</code> or both are out of range.</li></ul></td></tr>
</tbody></table>
<p>After you implement all the functions above, you will need to fill out the array of <code>PyMethodDef</code> structs <code>Matrix61c_methods</code> in <code>src/numc.c</code>, which is used to define the object type <code>numc.Matrix</code>.</p>
<p>This link tells you what goes into a <code>PyMethodDef</code> struct: <a href="https://docs.python.org/3/c-api/structures.html">https://docs.python.org/3/c-api/structures.html</a></p>
<h3 id="indexing">Indexing</h3>
<p>As mentioned in task 1, if you are storing your matrix data in a non-row-major order, you might want to change your <code>Matrix61c_subscript</code>.</p>
<p>Regardless of how you are storing you matrices, now is a good time to check if your <code>allocate_matrix_ref</code> in <strong><code>src/matrix.c</code></strong> is working as intended. A correct implementation of <code>allocate_matrix_ref</code> and <code>Matrix61c_subscript</code> should result in behaviors specified in <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#indexing">the indexing info section</a> above. <strong>More importantly, please take some time to make sure that you don't have memory leaks!</strong>
 In other words, you need to make sure that when all references to a 
matrix is gone, that matrix's data need to be free'd immediately. 
However, when the parent itself is gone but there are still existing 
slices of this matrix, you can delay the freeing of the parent's data 
until all those slices are also gone. Here's an example to what is meant
 by the above.</p>
<pre style="background-color:#2b303b;"><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span style="color:#c0c5ce;">numc </span><span style="color:#b48ead;">as </span><span style="color:#c0c5ce;">nc
a = nc.</span><span style="color:#bf616a;">Matrix</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">)
b = a[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">] </span><span style="color:#65737e;"># b is referencing a's data
</span><span style="color:#b48ead;">del </span><span style="color:#c0c5ce;">a </span><span style="color:#65737e;"># a is gone, but you don't have to free a's data right now
</span><span style="color:#b48ead;">del </span><span style="color:#c0c5ce;">b </span><span style="color:#65737e;"># b is gone, now you need to free a's data
</span></code></pre>
<hr>
<h3 id="how-to-debug">How to Debug</h3>
<p>To debug the Python-C interface, we suggest that you write your test files in Python, and use gdb or both gdb and pdb to debug.</p>
<div id="only-gdb"></div>
<h4 id="using-only-gdb">Using only gdb</h4>
<p>You don't have to use pdb if you do not wish to set breakpoints in your Python test file. Open your terminal and run</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> gdb python3
</span></code></pre>
<p>Then you can set breakpoints in your C files using the normal gdb commands. gdb will warn you with</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">No source file named {your c file}
Make breakpoint pending on future shared library load? (y or [n])
</span></code></pre>
<p>Press 'y' (without the quotes) to proceed.</p>
<p>After that, you can run <code>run {your python test file name}.py</code> in gdb, and gdb will break at the breakpoints that you just set.</p>
<h4 id="using-both-gdb-and-pdb">Using both gdb and pdb</h4>
<p>You will have to use pdb if you wish to set breakpoints in your Python file. Here's how it works. Start gdb by running</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> gdb python3
</span></code></pre>
<p>and set your breakpoints in C (see <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#only-gdb">previous section</a>). Then you will need to run in gdb</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">run -m</span><span style="color:#c0c5ce;"> pdb {your python file}.py
</span></code></pre>
<p>After this step, you can set breakpoints in your Python file using gdb syntax (for example, <code>b test.py:5</code>).
 With this approach, your debugger will switch between pdb and gdb 
depending on whether you are stepping through a Python file or a C file.
 If you are seeing values being optimized out on gdb, try changing <code>O3</code> to <code>O0</code> in <code>setup.py</code>, then reinstalling your module.</p>
<h2 id="task-3-speeding-up-matrix-operations">Task 3: Speeding up matrix operations</h2>
<p><strong>Before contacting the staff about any issues that you encounter, please have a look through the FAQ <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#frequently-asked-questions">here</a>.</strong></p>
<p>Now that you have completed the two steps above and successfully installed your naive version of <code>numc</code>, it's time to speed up your matrix functions in <strong><code>src/matrix.c</code></strong>! Below we outline some steps for boosting performance.</p>
<p><strong>Please note that cache blocking, a technique to rearrange 
data access to pull subsets (blocks) of data into cache and to operate 
on this block to avoid having to repeatedly fetch data from main memory,
 is not necessary to meet the benchmark speedups.</strong></p>
<h3 id="step-1-algorithmic-and-other-optimizations">Step 1: Algorithmic and Other Optimizations</h3>
<p>You should first try to speed up the computation by trying to apply 
conventional code optimizations (i.e. without using SSE or OpenMP). 
While we wonâ€™t tell you the exact steps, here are some hints that should
 help you get started:</p>
<ol>
<li>Function calls are expensive since they involve setting up a stack 
frame and jumping to a different part of code. See if there are any 
functions that are frequently called that donâ€™t necessarily need to be.</li>
<li>Are there any places where you can apply algorithmic optimizations? A
 good place to begin is by viewing the various exponentiation techniques
 described <a href="https://flylib.com/books/en/3.487.1.22/1/">here</a> (and few of the following pages as well).</li>
<li>Is there any unnecessary computation being done?</li>
<li>Are there any places where you could do manual loop unrolling?</li>
</ol>
<p>Note that the above hints relate to general optimization practices. 
You do not necessarily need to do all of these to achieve a good 
speedup.</p>
<p>Once you have improved performance using these optimizations, you can
 start applying vectorization and parallelization to make the program 
even faster. Note that you have considerable freedom to apply any of 
these optimizations, and there is more than one correct solution. Try to
 experiment with different approaches and see which one gives you the 
best performance.</p>
<h3 id="step-2-simd-instructions">Step 2: SIMD Instructions</h3>
<p>From lectures, you learned how to apply SIMD instructions to improve 
performance. The processors in the hive machines support the Intel AVX 
extensions, which allow you to do SIMD operations on 256 bit values (not
 just 128 bit, as we have seen in the lab). You should use these 
extensions to perform four operations in parallel (since all floating 
point numbers are doubles, which are 64 bit in size). If you are 
unfamiliar with SIMD instructions, lab 9 can be a good warmup.</p>
<p>As a reminder, you can use the <a href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/">Intel Intrinsics Guide</a> as a reference to look up the relevant instructions. You will have to use the <code>__m256d</code> type to hold 4 doubles in a YMM register, and then use the <code>_mm256_*</code> intrinsics to operate on them.</p>
<p>Here is a list of AVX instructions that you may find helpful, 
although you are also allowed to use other AVX instructions not on the 
list.</p>
<pre style="background-color:#2b303b;"><code class="language-c" data-lang="c"><span style="color:#b48ead;">void </span><span style="color:#8fa1b3;">_mm256_storeu_pd </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">double </span><span style="color:#c0c5ce;">* </span><span style="color:#bf616a;">mem_addr</span><span style="color:#c0c5ce;">, __m256d </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">)
__m256d </span><span style="color:#8fa1b3;">_mm256_set1_pd </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">double </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">)
__m256d </span><span style="color:#8fa1b3;">_mm256_set_pd </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">double </span><span style="color:#bf616a;">e3</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">double </span><span style="color:#bf616a;">e2</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">double </span><span style="color:#bf616a;">e1</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">double </span><span style="color:#bf616a;">e0</span><span style="color:#c0c5ce;">)
__m256d </span><span style="color:#8fa1b3;">_mm256_loadu_pd </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">double const </span><span style="color:#c0c5ce;">* </span><span style="color:#bf616a;">mem_addr</span><span style="color:#c0c5ce;">)
__m256d </span><span style="color:#8fa1b3;">_mm256_add_pd </span><span style="color:#c0c5ce;">(__m256d </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">, __m256d </span><span style="color:#bf616a;">b</span><span style="color:#c0c5ce;">)
__m256d </span><span style="color:#8fa1b3;">_mm256_sub_pd </span><span style="color:#c0c5ce;">(__m256d </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">, __m256d </span><span style="color:#bf616a;">b</span><span style="color:#c0c5ce;">)
__m256d </span><span style="color:#8fa1b3;">_mm256_fmadd_pd </span><span style="color:#c0c5ce;">(__m256d </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">, __m256d </span><span style="color:#bf616a;">b</span><span style="color:#c0c5ce;">, __m256d </span><span style="color:#bf616a;">c</span><span style="color:#c0c5ce;">)
__m256d </span><span style="color:#8fa1b3;">_mm256_mul_pd </span><span style="color:#c0c5ce;">(__m256d </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">, __m256d </span><span style="color:#bf616a;">b</span><span style="color:#c0c5ce;">)
__m256d </span><span style="color:#8fa1b3;">_mm256_cmp_pd </span><span style="color:#c0c5ce;">(__m256d </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">, __m256d </span><span style="color:#bf616a;">b</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">const int </span><span style="color:#bf616a;">imm8</span><span style="color:#c0c5ce;">)
__m256d </span><span style="color:#8fa1b3;">_mm256_and_pd </span><span style="color:#c0c5ce;">(__m256d </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">, __m256d </span><span style="color:#bf616a;">b</span><span style="color:#c0c5ce;">)
__m256d </span><span style="color:#8fa1b3;">_mm256_max_pd </span><span style="color:#c0c5ce;">(__m256d </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">, __m256d </span><span style="color:#bf616a;">b</span><span style="color:#c0c5ce;">)
</span></code></pre><h3 id="step-3-openmp">Step 3: OpenMP</h3>
<p>Finally you should use OpenMP to parallelize computation. Note that 
you will need to make sure that none of the different threads overwrites
 each othersâ€™ data. Just adding a <code>#pragma omp parallel for</code> may cause errors. Here are a few useful links to use as a starting point: <a href="https://curc.readthedocs.io/en/latest/programming/OpenMP-C.html">Using OpenMP with C</a> and <a href="https://docs.microsoft.com/en-us/cpp/parallel/openmp/reference/openmp-functions?view=msvc-160">OpenMP Functions</a>.</p>
<p>Note that the Hive machines have 4 cores with two hyperthreads each. 
This means that you should expect a speed-up of 4-8x (note that 
hyperthreads mean that two different threads execute on the same 
physical core at the same time; they will therefore compete for 
processor resources, and as a result, you will not get the same 
performance as if you were running on two completely separate cores).</p>
<h3 id="loop-unrolling">Loop Unrolling</h3>
<p>Please note that depending on your implementation, loop unrolling 
might not increase your performance. This is due to the fact that within
 large code with large inputs, loop unrolling does not work if the 
compiler can't predict the exact amount of iterations of the loop at 
compile time. However, manual unrolling may indeed increase your speedup
 values. This might not work for some students due to their 
implementation, however, it may work for some. Due to this, the staff 
solutions used to determine the benchmark speedups did not include loop 
unrolling. You may have a read <a href="https://stackoverflow.com/questions/24196076/is-gcc-loop-unrolling-flag-really-effective">here</a> and test it out by viewing the assembly dump by running gcc with the <strong><code>-S</code></strong> flag on your <code>src/matrix.c</code> file.</p>
<h2 id="task-4-tell-us-what-you-did">Task 4: Tell us what you did!</h2>
<p>Write up what you did in your README.md! We have provided a template 
for you to use where you should discuss what you did as a whole, the 
different python functions you implemented, what performance 
improvements you had, what were you surprised about, etc. More 
specifically, we want you to document your <code>numc</code> module. <strong>We expect a minimum of 1000 characters (1000 characters from each partner if working in pairs).</strong>
Again, failure to complete this task may result in negative points, so make sure you do it or you will lose points!</p>
<h2 id="testing">Testing</h2>
<p><strong>We will not be grading your tests but we will NOT help you 
debug unless you have written a test which shows how your code is 
failing. This means just using the autograder to figure out your issues 
will not be acceptable for office hours.</strong></p>
<p>We use <strong><code>tests/unittests</code></strong> as the framework for testing and have provided a <code>tests/unittests</code> folder that contains this framework for testing your python module. You should be familiar with <code>unittest</code> by now as you have had experience with it in project 2. <strong>Here is the official documentation for the standard <a href="https://docs.python.org/3.6/library/unittest.html">Python unittest library</a>.</strong>
<code>tests/unittests/unittests.py</code> contains all the skeleton code for both correctness and performance tests, and <code>tests/unittests/utils.py</code>
 has all the functions that you might need in order to write tests. We 
have provided some sample tests for you, but it is up to you to design 
and code up the tests. We will not be grading your tests.</p>
<p>As mentioned in <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#tip">Tips and Guidelines</a> and <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj4/#getting-started">Getting Started</a>, we have installed the naive solution which we will be comparing against on hive! The python package is called <code>dumbpy</code>
 and you can import it like any other python library (so long as you are
 on hive)! Please note we will not be distributing this binary which 
means you must work on hive if you want to test with it. You should use 
this and the <strong><code>time</code></strong> package to determine how much you sped up your code.</p>
<h3 id="functions-in-tests-unittests-utils-py">Functions in <code>tests/unittests/utils.py</code></h3>
<ul>
<li>
<p><strong><code>dp_nc_matrix(*args, **kwargs)</code></strong></p>
<ul>
<li>This function will return a <code>dumbpy</code> matrix and a <code>numc</code> matrix that are identical. <code>*args</code> and <code>**kwargs</code> will be used as the arguments to instantiate both matrices in the exact same format as you would instantiate a <code>numc.Matrix</code>. We provide some examples below.<pre style="background-color:#2b303b;"><code class="language-python" data-lang="python"><span style="color:#c0c5ce;"> &gt;&gt;&gt; dp_mat, nc_mat = </span><span style="color:#bf616a;">dp_nc_matrix</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;"> &gt;&gt;&gt; dp_mat
</span><span style="color:#c0c5ce;"> [[</span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">]]
</span><span style="color:#c0c5ce;"> &gt;&gt;&gt; nc_mat
</span><span style="color:#c0c5ce;"> [[</span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">]]
</span><span style="color:#c0c5ce;"> &gt;&gt;&gt; dp_mat, nc_mat = </span><span style="color:#bf616a;">dp_nc_matrix</span><span style="color:#c0c5ce;">([[</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">]])
</span><span style="color:#c0c5ce;"> &gt;&gt;&gt; dp_mat
</span><span style="color:#c0c5ce;"> [[</span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3.0</span><span style="color:#c0c5ce;">]]
</span><span style="color:#c0c5ce;"> &gt;&gt;&gt; nc_mat
</span><span style="color:#c0c5ce;"> [[</span><span style="color:#d08770;">1.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2.0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">3.0</span><span style="color:#c0c5ce;">]]
</span></code></pre></li>
</ul>
</li>
<li>
<p><strong><code>rand_dp_nc_matrix(rows, cols, low=0, high=1, seed=0)</code></strong></p>
<ul>
<li>This function will instantiate a random <code>dumbpy</code> matrix and a random <code>numc</code> matrix with <code>seed</code> where each element is in the range [low, high). The two matrices are identical with <code>rows</code> rows and <code>cols</code>. <code>seed</code> is defaulted to 0.<pre style="background-color:#2b303b;"><code class="language-python" data-lang="python"><span style="color:#c0c5ce;">&gt;&gt;&gt;&gt; dp_mat, nc_mat = </span><span style="color:#bf616a;">rand_dp_nc_matrix</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">seed</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">)
</span><span style="color:#c0c5ce;">&gt;&gt;&gt; dp_mat
</span><span style="color:#c0c5ce;">[[</span><span style="color:#d08770;">0.27474559623503386</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.046467764790387715</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">0.9927552244592249</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.08003044504673706</span><span style="color:#c0c5ce;">]]
</span><span style="color:#c0c5ce;">&gt;&gt;&gt; nc_mat
</span><span style="color:#c0c5ce;">[[</span><span style="color:#d08770;">0.27474559623503386</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.046467764790387715</span><span style="color:#c0c5ce;">], [</span><span style="color:#d08770;">0.9927552244592249</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">0.08003044504673706</span><span style="color:#c0c5ce;">]]
</span></code></pre></li>
</ul>
</li>
<li>
<p><strong><code>cmp_dp_nc_matrix(dp_mat: dp.Matrix, nc_mat: nc.Matrix)</code></strong></p>
<ul>
<li>This function will return True if <code>dp_mat</code> has the same size of <code>nc_mat</code> and all corresponding elements are equal (within a margin of error).</li>
</ul>
</li>
<li>
<p><strong><code>compute(dp_mat_lst: List[Union[dp.Matrix, int]], nc_mat_lst: List[Union[nc.Matrix, int]], op: str)</code></strong></p>
<ul>
<li>This function takes in a list of dumbpy matrices and a list of numc matrices, then applies the specified operation <code>op</code> on these matrices. Note that <code>op</code> is a string. <code>"add"</code>, <code>"sub"</code>, <code>"mul"</code>, <code>"neg"</code>, <code>"abs"</code>, and <code>"pow"</code> correspond to the operations <code>+</code>, <code>-</code>(subtraction), <code>*</code>, <code>-</code>(negation), and <code>abs</code>, respectively. This function will return whether the computed <code>dumbpy</code> matrix is equal to the computed <code>numc</code> matrix, as well as the speedup for this specific computation. 
<ul>
<li>For unary operations like <code>"neg"</code> and <code>"abs"</code>, each matrix list must only contain 1 matrix. For the binary operations, they must contain more than 1 matrix.</li>
<li>Note that to compute <code>"pow"</code>, <code>dp_mat_lst</code> and <code>nc_mat_lst</code> should look like something like <code>[Matrix(2, 2), 1]</code>.</li>
<li>You can also do chained operations like <code>compute([a, b, c], [d, e, f], "add")</code> where <code>a, b, c, d, e, f</code> are matrices, and the function will compute <code>a + b + c</code> and <code>d + e + f</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="more-about-unittest">More about <code>unittest</code></h3>
<ul>
<li>Running<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> python</span><span style="color:#bf616a;"> -m</span><span style="color:#c0c5ce;"> unittest unittests.py</span><span style="color:#bf616a;"> -v
</span></code></pre>will run all tests in <code>unittests.py</code>.</li>
<li>If you only want to run tests of one particular class, run<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> python</span><span style="color:#bf616a;"> -m</span><span style="color:#c0c5ce;"> unittest unittests.{classname}</span><span style="color:#bf616a;"> -v
</span></code></pre>For example, running<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> python</span><span style="color:#bf616a;"> -m</span><span style="color:#c0c5ce;"> unittest unittests.TestAdd</span><span style="color:#bf616a;"> -v
</span></code></pre>will only run the tests under the <code>TestAdd</code> class.</li>
<li>If you want to run a specific test under a specific class, run<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> python</span><span style="color:#bf616a;"> -m</span><span style="color:#c0c5ce;"> unittest unittests.{classname}.{testname}</span><span style="color:#bf616a;"> -v
</span></code></pre>For example, running <pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> python</span><span style="color:#bf616a;"> -m</span><span style="color:#c0c5ce;"> unittest unittests.TestAdd.test_small_add</span><span style="color:#bf616a;"> -v
</span></code></pre>will only run the <code>test_small_add</code> test.</li>
</ul>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<div id="faq"></div>
<h3 id="task-1">Task 1</h3>
<div id="1.1"></div>
<ul>
<li><strong>Q 1.1</strong>: Will we be graded on what types of errors we threw? Or do we just have to throw some error?<br>
<strong>A 1.1</strong>: Yes we expect you to throw the correct error types. We do not care about the error strings tho.<br><br></li>
</ul>
<div id="1.2"></div>
<ul>
<li><strong>Q 1.2</strong>: I'm getting this when I run <code>make test</code>, what is happening?<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">rm -f test
</span><span style="color:#c0c5ce;">gcc -g -Wall -std=c99 -fopenmp -mavx -mfma -pthread -O3 mat_test.c src/matrix.c -o test -fopenmp -L/home/ff/cs61c/cunit/install/lib -I/home/ff/cs61c/cunit/install/include -lcunit -I/usr/include/python3.6 -lpython3.6m
</span><span style="color:#c0c5ce;">./test
</span><span style="color:#c0c5ce;">     CUnit - A unit testing framework for C - Version 2.1-2
</span><span style="color:#c0c5ce;">     http://cunit.sourceforge.net/
</span><span style="color:#c0c5ce;">Makefile:25: recipe for target 'test' failed
</span><span style="color:#c0c5ce;">make: *** [test] Illegal instruction (core dumped)
</span></code></pre><strong>A 1.2</strong>: This means your code 
segfaulted before any assert statements was reached and none of the 
tests passed. Use gdb to locate your bug.<br><br></li>
</ul>
<div id="1.3"></div>
<ul>
<li><strong>Q 1.3</strong>: Do we assume rows and cols start at 1 or 0?<br>
<strong>A 1.3</strong>: They are both zero-indexed.<br><br></li>
</ul>
<div id="1.4"></div>
<ul>
<li><strong>Q 1.4</strong>: Do our functions need to support self-referential operations? For example, <code>mul_matrix(mat, mat, mat)</code>.<br>
<strong>A 1.4</strong>: No.<br><br></li>
</ul>
<div id="1.5"></div>
<ul>
<li><strong>Q 1.5</strong>: Is it reasonable to run valgrind on <code>./test</code>? <br>
<strong>A 1.5</strong>: You can try, but would not recommend. Setting up valgrind for C-Python interface can be difficult.<br><br></li>
</ul>
<div id="1.6"></div>
<ul>
<li><strong>Q 1.6</strong>: When we throw an error, is it just a fprintf call to stderr?<br>
<strong>A 1.6</strong>: Nope, you should throw errors in a python 
context. i.e., when your python code calls this underlying C function, 
it should error. Take a look at the Python/C API's reference manual for <a href="https://docs.python.org/3.6/c-api/exceptions.html">exception handling</a>.<br><br></li>
</ul>
<div id="1.7"></div>
<ul>
<li><strong>Q 1.7</strong>: Can we make a slice on slice? for example, <code>mat1 = [[1,2,3],[4,5,6]]</code>, <code>mat2 = mat1[0]</code>. Can we do <code>mat3 = mat2[0]</code>?<br>
<strong>A 1.7</strong>: No a "slice" on slice is just a number and is pass by value. In this case, <code>mat3</code> will just be a number and changing its value will not change <code>mat2</code>.<br><br></li>
</ul>
<div id="1.8"></div>
<ul>
<li>
<p><strong>Q 1.8</strong>: Does our solution need to exactly match the reference?<br>
<strong>A 1.8</strong>: No, we allow an error margin of 1e-6.<br><br></p>
</li>
<li>
<p><strong>Q 1.9</strong>: The values in my matrices change after I print their slices.<br>
<strong>A 1.9</strong>: This is likely a memory leak. Double check your <code>deallocate_matrix</code> implementation. What happens when you call <code>print(mat[0])</code> is that it will create a slice, then immediately deallocate it after this line.<br><br></p>
</li>
</ul>
<h3 id="task-2">Task 2</h3>
<div id="2.1"></div>
<ul>
<li><strong>Q 2.1</strong>: Getting <code>&lt;class 'AttributeError'&gt; -- shape</code>.<br>
<strong>A 2.1</strong>: Make sure the relevant method in src/numc.c is setting <code>mat-&gt;shape</code><br><br></li>
</ul>
<div id="2.2"></div>
<ul>
<li><strong>Q 2.2</strong>: Getting <code>&lt;class 'SystemError'&gt; --
 &lt;built-in method set of numc.Matrix object at 0x7f175faffef0&gt; 
returned NULL without setting an error!</code><br>
<strong>A 2.2</strong>: You need to throw an error before returning <code>NULL</code> in any interface function.<br><br></li>
</ul>
<div id="2.3"></div>
<ul>
<li><strong>Q 2.3</strong>: <code>UnicodeDecodeError: â€˜utf-8â€™ codec can't decode byte 0x89 in position 5: invalid start byte</code> upon import. What's wrong?<br>
<strong>A 2.3</strong>: <code>{NULL, NULL, 0, NULL}</code> from starter code must be last element of <code>Matrix61c_methods</code>, so make sure you don't accidentally remove that!<br><br></li>
</ul>
<div id="2.4"></div>
<ul>
<li><strong>Q 2.4</strong>: Are we allowed to call methods we wrote in <strong><code>src/matrix.c</code></strong>?<br>
<strong>A 2.4</strong>: Yes please do!<br><br></li>
</ul>
<div id="2.5"></div>
<ul>
<li><strong>Q 2.5</strong>: How do we know what gets passed into <code>PyObject* args</code>?<br>
<strong>A 2.5</strong>: Read the <a href="https://docs.python.org/3.6/c-api/">official documentation</a>! (You can also take a look at the starter code for examples.)<br><br></li>
</ul>
<div id="2.6"></div>
<ul>
<li><strong>Q 2.6</strong>: Is it safe to cast <code>PyLong_AsLong</code> as int?<br>
<strong>A 2.6</strong>: Yes! You can assume that all integer values in this project will never overflow.<br><br></li>
</ul>
<div id="3.7"></div>
<ul>
<li><strong>Q 2.7</strong>: Does the sign of 0.0 matter when negating matrices?<br>
<strong>A 2.7</strong>: No.<br><br></li>
</ul>
<div id="2.8"></div>
<ul>
<li><strong>Q 2.8</strong>: Should <code>Matrix61c_multiply</code> cover both <code>nb_matrix_multiply</code> and <code>nb_multiply</code>, or just <code>nb_multiply</code>?<br>
<strong>A 2.8</strong>: Just <code>nb_multiply</code>. <code>nb_matrix_multiply</code> corresponds to the operator <code>@</code>.<br><br></li>
</ul>
<div id="2.9"></div>
<ul>
<li><strong>Q 2.9</strong>: My <code>dumbpy</code> and <code>numc</code> matrices are exactly the same, however, comparing them using <code>==</code> returns False.<br>
<strong>A 2.9</strong>: You cannot compare them like that as they are of different object types. Please use <code>cmp_dp_nc_matrix</code>, which is provided in <code>unittests/utils.py</code>. <br><br></li>
</ul>
<h3 id="task-3">Task 3</h3>
<div id="3.1"></div>
<ul>
<li><strong>Q 3.1</strong>: <code>#pragma omp parallel for</code> above a simple for loop slows down my add_matrix drastically?<br>
<strong>A 3.1</strong>: You need big matrices to actually see the effect of speedup (something around 1000 * 1000).<br><br></li>
</ul>
<div id="3.2"></div>
<ul>
<li><strong>Q 3.2</strong>: I'm getting <code>warning: ignoring #pragma omp parallel [-Wunknown-pragmas]</code> but I have not changed the Makefile?<br>
<strong>A 3.2</strong>: It might be your <code>setup.py</code> file. Take a look at the compiler and linker flags we provided you.<br><br></li>
</ul>
<h3 id="autograder-related-questions">Autograder-related Questions</h3>
<div id="4.1"></div>
<ul>
<li><strong>Q 4.1</strong>: I'm passing my local correctness tests but failing autograder. What might be the case?<br>
<strong>A 4.1</strong>: Here are some common sources of bugs:
<ul>
<li>Make sure you test your matrix operations on non-integer floating 
point values (such as 1.2, 1.3). In the past semester, some students' 
code was only able to generate correct results when every floating point
 value in their matrices were integer-valued floating points (such as 
1.0, 2.0). </li>
<li>Make sure you are setting the <code>shape</code> attribute of every returned matrix! </li>
<li>Please do NOT modify anything related to generating random matrices!
 Do NOT try to speed them up! We use those to generate matrices to test 
on the autograder. We don't include the time for generating matrices 
when testing for performance. </li>
<li>Please make sure that you have removed all your debug print statements. <br><br></li>
</ul>
</li>
</ul>
<div id="4.2"></div>
<ul>
<li><strong>Q 4.2</strong>: Performance tests are failing but correctness tests all pass.<br>
<strong>A 4.2</strong>: Our performance tests test on much larger matrices than the correctness tests, so make sure you handle those cases correctly!<br><br></li>
</ul>
<div id="4.3"></div>
<ul>
<li><strong>Q 4.3</strong>: Failing tests that are related to throwing errors.<br>
<strong>A 4.3</strong>: Make sure you are throwing the correct type of error, not just any error.<br><br></li>
</ul>
<div id="4.4"></div>
<ul>
<li><strong>Q 4.4</strong>: Failing abs correctness test, even though my <code>abs_matrix</code> logic is very simple.<br>
<strong>A 4.4</strong>: Check if you are using C's built-in <code>abs</code> function. If so, you probably want to manually write another one since the built-in <code>abs</code> function will round off all decimal places. <br><br></li>
</ul>
<h3 id="testing-questions">Testing Questions</h3>
<div id="5.1"></div>
<ul>
<li>
<p><strong>Q 5.1</strong>: Why are there <code>TODO: YOUR CODE HERE</code> comments in the test functions in <code>unittests.py</code> even though these functions have already been implemented for us? <br>
<strong>A 5.1</strong>: The tests we have provided are VERY simple and 
they are purely examples to help you write more tests. Please modify 
these tests or add more tests for more comprehensive testing.</p>
</li>
<li>
<p><strong>Q 5.2</strong>: My tests are failing inside <code>rand_md5</code>, is this a bug from the starter code? <br>
<strong>A 5.2</strong>: No. Make sure your implementations <code>Matrix61c_get_value</code> and <code>Matrix61c_get_value</code> are correct! Otherwise <code>rand_md5</code> might error.</p>
</li>
</ul>
<div id="grading"></div>
<h2 id="grading">Grading</h2>
<p>The grading breakdown for Project 4 is as follows:</p>
<ul>
<li>Correctness: 55%
<ul>
<li>Visible (<strong>25 pts</strong>):
<ul>
<li>Provided Basic Correctness Tests (25 <strong>pts</strong>)</li>
</ul>
</li>
<li>Hidden (<strong>30 pts</strong>):
<ul>
<li>Wrong Args Test (6 <strong>pts</strong>)</li>
<li>Memory Leak Test (7 <strong>pts</strong>)</li>
<li>Dimension Test (4 <strong>pts</strong>)</li>
<li>Slice After Matrix Test (2 <strong>pts</strong>)</li>
<li>Matrix After Slice Test (2 <strong>pts</strong>)</li>
<li>Indexing Test (3 <strong>pts</strong>)</li>
<li>Get/Set Index Error Test (2 <strong>pts</strong>)</li>
<li>Function not in-place test (4 <strong>pts</strong>)</li>
</ul>
</li>
</ul>
</li>
<li>Speedup [<strong>Visible</strong>]: 40%
<ul>
<li>Multiplication: 20%</li>
<li>Power: 25%</li>
<li>Simple: 12.5%</li>
<li>Comprehensive: 42.5%</li>
</ul>
</li>
<li>README.md [<strong>Hidden</strong>]: 5%</li>
</ul>
<p>**Updated on August 3rd: **
Here are the graphs for the speedup tests. The x-axis is your speedup 
times and the y-axis indicates what percentage of that test's total 
score you will receive. </p>
<p>** Updated on August 6th: Graphs have been updated **</p>
<div class="grading-graphs" markdown="1">
<table><thead><tr><th align="center">Multiplication</th><th align="center">Power</th></tr></thead><tbody>
<tr><td align="center"><img src="Project%204%20-%20CS%2061C_files/mul.png" alt="mul.png"></td><td align="center"><img src="Project%204%20-%20CS%2061C_files/pow.png" alt="pow.png"></td></tr>
</tbody></table>
<table><thead><tr><th align="center">Simple</th><th align="center">Comprehensive</th></tr></thead><tbody>
<tr><td align="center"><img src="Project%204%20-%20CS%2061C_files/simple.png" alt="simple.png"></td><td align="center"><img src="Project%204%20-%20CS%2061C_files/comprehensive.png" alt="comprehensive.png"></td></tr>
</tbody></table>
</div>
<p><b>[Benchmark update : 08/06]</b> Minimum speedup for 100% on each test:</p>
<ul>
<li>Multiplication: 83x</li>
<li>Power: 850x</li>
<li>Simple: 4x</li>
<li>Comprehensive: 85x</li>
</ul>
<p>Since we are running your submissions on hive, albeit reserved, 
speedup times may fluctuate a bit. You should try to go above the 
speedup value as we will rerun the ag after the deadline and your 
speedup may go up or down. We will not rerun submissions if they went 
down unless we made another change to the autograder.</p>
<p>We will only be using your <code>src/matrix.h</code>, <code>src/matrix.c</code>, <code>src/numc.c</code>, and <code>README.md</code>
 for grading. Gradescope only shows you all the core correctness tests 
that are needed to run performance tests. Other tests will stay hidden 
until the late due date. <strong>Keep in mind that your <code>Matrix61c_get</code> method in <code>src/numc.c</code> as well as the shapes you set for your matrices need to be correct in order for you to pass any of those correctness tests.</strong></p>
<div id="submit"></div>
<h2 id="submitting-your-code">Submitting Your Code</h2>
<p>Please submit using Gradescope to Project 4, using the GitHub 
submission option to ensure that your files are in the right place.</p>
<div class="alert alert-warning">
    <b>Warning</b>: If you have a partner, you <b>MUST</b> add your 
partner to every submission on Gradescope or it may be flagged for 
cheating. The person submitting can change, but both partners must be 
added to every submission.
</div>

  </div>
</div>

      </div>
    </section>
  </main>

  
<script>
  

  
    document.addEventListener("DOMContentLoaded", function() {
      initToC();
    });
  
</script>




</body></html>